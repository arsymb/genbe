<!DOCTYPE html>
<html layout:decorate="~{base}" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org">

<div class="row mb-2" layout:fragment="content-header">
	<div class="col-sm-12">
		<ol class="breadcrumb float-sm-right">
			<li class="breadcrumb-item"><a href="/home">Home</a></li>
			<li class="breadcrumb-item active">Tabel Biodata</li>
		</ol>
	</div>
</div>


<div class="row" layout:fragment="content-body">
	<div class="col-sm-12">
		<div class="card card-warning">
			<h3 class="card-header text-center">
				<b>TABEL BIODATA</b>
			</h3>
			<!-- /.card-header -->
		
			<div class="card-body">
				<label for="nik">NIK:</label> 
					<div class="row">
						<div class="col-sm-4">
							<input type="text" class="form-control" id="nik" placeholder="Masukkan nomor NIK">
						</div>
						<div class="col-sm-2">
							<button type="button" class="btn btn-secondary" id="nikSearch">Search</button>
						</div>
					</div>
			</div>
				
			<div class="card-body table-responsive">
				<table id="table_biodata" class="table table-striped table-bordered table-hover nowrap"
					style="width: 100%">
				</table>
			</div>
		<!-- /.card-body -->
		</div>	
	</div>
</div>


<th:block layout:fragment="add-scripts">
	<script th:src="@{/assets/plugins/chart.js/Chart.min.js}"></script>
	<script th:src="@{/assets/js/demo.js}"></script>
	<script th:src="@{/assets/js/pages/dashboard3.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
	<script>
/* 	$(function(){
		$('#nikSearch').click(function () {
			$.ajax({
				type: 'GET',
                url: '/person/pendidikan/' + $("#nik").val(),
                success: function (result) {
                	console.log(result);
                	const Toast = Swal.mixin({
              		  toast: true,
              		  position: 'top-end',
              		  showConfirmButton: false,
              		  timer: 3000,
              		  timerProgressBar: true,
              		  onOpen: (toast) => {
              		    toast.addEventListener('mouseenter', Swal.stopTimer)
              		    toast.addEventListener('mouseleave', Swal.resumeTimer)
              		  }
              		})

              		if(result.message=='success'){
              			Toast.fire({
		                	icon: 'success',
		                	title: 'status: ' + result.status + '\nmessage: ' + result.message + ''
		                })
		                $('#table_biodata').DataTable({
		                	"scrollX": true,
	                    	data : [result.data],
	                    	columns: [
	                           	{
	                               	title: "NIK",
	                               	data: "nik"
	                           	},
	                           	{
	                               	title: "Name",
	                               	data: "name"
	                           	},
	                           	{
	                               	title: "Address",
	                               	data: "address"
	                           	},
	                           	{
	                               	title: "No. HP",
	                               	data: "hp"
	                           	},
	                           	{
	                               	title: "Tanggal Lahir",
	                               	data: "tgl"
	                           	},
	                           	{
	                               	title: "Tempat Lahir",
	                               	data: "tempatLahir"
	                           	},
	                           	{
	                               	title: "Umur",
	                               	data: "umur"
	                           	},
	                           	{
	                               	title: "Pendidikan Terakhir",
	                               	data: "pendidikan_terakhir"
	                           	}
	                        ]
	                    });	
              		} else{
              			Toast.fire({
		                	icon: 'error',
		                	title: 'status: ' + result.status + '\nmessage: ' + result.message + ''
		                })
              		}
                }, error: function (xhr) {
                	alert('An error occured: ' + xhr.status + ' ' + xhr.statusText);
                }
			});
		});
			
	}); */

	var tableBiodata = {
		    addToTable: function() {
		    	$.ajax({
					type: 'GET',
	                url: '/person/pendidikan/' + $("#nik").val(),
	                success: function (result) {
	                	console.log(result);
	                	const Toast = Swal.mixin({
	              		  toast: true,
	              		  position: 'top-end',
	              		  showConfirmButton: false,
	              		  timer: 3000,
	              		  timerProgressBar: true,
	              		  onOpen: (toast) => {
	              		    toast.addEventListener('mouseenter', Swal.stopTimer)
	              		    toast.addEventListener('mouseleave', Swal.resumeTimer)
	              		  }
	              		})

	              		if(result.message=='success'){
	              			Toast.fire({
			                	icon: 'success',
			                	title: 'status: ' + result.status + '\nmessage: ' + result.message + ''
			                })
			                $('#table_biodata').DataTable({
			                	"scrollX": true,
		                    	data : [result.data],
		                    	columns: [
		                           	{
		                               	title: "NIK",
		                               	data: "nik"
		                           	},
		                           	{
		                               	title: "Name",
		                               	data: "name"
		                           	},
		                           	{
		                               	title: "Address",
		                               	data: "address"
		                           	},
		                           	{
		                               	title: "No. HP",
		                               	data: "hp"
		                           	},
		                           	{
		                               	title: "Tanggal Lahir",
		                               	data: "tgl"
		                           	},
		                           	{
		                               	title: "Tempat Lahir",
		                               	data: "tempatLahir"
		                           	},
		                           	{
		                               	title: "Umur",
		                               	data: "umur"
		                           	},
		                           	{
		                               	title: "Pendidikan Terakhir",
		                               	data: "pendidikan_terakhir"
		                           	}
		                        ]
		                    });	
	              		} else{
	              			Toast.fire({
			                	icon: 'error',
			                	title: 'status: ' + result.status + '\nmessage: ' + result.message + ''
			                })
	              		}
	                }, error: function (xhr) {
	                	alert('An error occured: ' + xhr.status + ' ' + xhr.statusText);
	                }
				});
		    }
	}

	$('#nikSearch').click(function(){
		if ($.fn.DataTable.isDataTable('#table_biodata')) {
        	//table yg sudah dibentuk menjadi datatable harus d rebuild lagi untuk di instantiasi ulang
        	$('#table_biodata').DataTable().clear();
        	$('#table_biodata').DataTable().destroy();
   		}
		tableBiodata.addToTable();
	});
	</script>
</th:block>

</html>